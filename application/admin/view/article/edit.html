<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        {include file="common/header" /}
        <script type="text/javascript" charset="utf-8" src="/static/ueditor/ueditor.config.js?v=1"></script>
        <script type="text/javascript" charset="utf-8" src="/static/ueditor/ueditor.all.min.js"> </script>
        <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
        <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
        <script type="text/javascript" charset="utf-8" src="/static/ueditor/lang/zh-cn/zh-cn.js"></script>
    </head>
    <body>
        <div class="layui-fluid">
            <div class="layui-row">
                <form class="layui-form" id="theform" method="post"  enctype="multipart/form-data">
                  <input type="hidden" name="articleid" value="{$row['articleid']}">
                  <div class="layui-form-item">
                      <label for="username" class="layui-form-label">
                          <span class="x-red"></span>文章标题
                      </label>
                      <div class="layui-input-inline">
                          <input type="text" value="{$row['title']}" placeholder="文章标题" lay-verify='required' id="username" name="title" 
                          autocomplete="off" class="layui-input">
                      </div>
                      <div class="layui-form-mid layui-word-aux">
                          <span class="x-red"></span>
                      </div>
                  </div>
                  <div class="layui-form-item">
                      <label for="image" class="layui-form-label">
                          <span class="x-red"></span>图片封面
                      </label>
                      <div class="layui-input-inline">
                          <input type="file" id="image" name="image" 
                          autocomplete="off">
                      </div>
                      <div class="layui-form-mid layui-word-aux">
                          <span class="x-red"></span>
                      </div>
                  </div>
                  <div style="position: relative;z-index:99999;" >
                    <div class="layui-form-item">
                      <label for="username" class="layui-form-label">
                          <span class="x-red">*</span>所属分类
                      </label>
                      <div class="layui-input-inline">
                          <select name="cate_id" lay-verify='required' >
                              <option value=''>请选择分类</option>
                              {volist name='categorys' id='v'}
                               <option value="{$v['categoryid']}">{:str_repeat('&nbsp;&nbsp;',$v['level']*2)}{$v['name']}</option>
                              {/volist}
                          </select>
                      </div>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label"><span class="x-red"></span>是否发布</label>
                    <div class="layui-input-block">
                        <input type="radio" name="is_publish"  value="0" lay-skin="primary" title="不发布" >
                        <input type="radio"  name="is_publish" checked="checked" value="1" lay-skin="primary" title="发布">
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label for="desc" class="layui-form-label">文章内容</label>
                    <div class="layui-input-block">
                      <textarea placeholder="请输入内容" id="desc" name="content" > 
                      {$row['content']}
                     </textarea>
                    </div>
                </div>
                  
                
                  <div class="layui-form-item">
                      <label for="L_repass" class="layui-form-label">
                      </label>
                      <button  class="layui-btn" lay-filter="add" lay-submit="">
                          增加
                      </button>
                  </div>
              </form>
            </div>
        </div>
        <script>

        //实例化编辑器
        //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
        var ue = UE.getEditor('desc');
        //设置文章所属分类默认选中
        var cate_id = "{$row['cate_id']}";
        $("select[name='cate_id']").val(cate_id);

        //设置指定的单选框的值默认选中状态
        var is_publish = "{$row['is_publish']}";
        $("input[name='is_publish'][value='"+is_publish+"']").prop('checked',true);

        layui.use(['form', 'layer'],function() {
              $ = layui.jquery;
              var form = layui.form,
              layer = layui.layer;

              //监听提交
              form.on('submit(add)',function(data) {
                 var formData  = new FormData(); //模拟表单数据
                 //序列换表单元素为一个json对象（serializeArray()）
                 var seriData = $("#theform").serializeArray();
                 //获取图片的数据
                 var image = $("#image")[0].files[0] || '';
                 //formData.append('image',image);
                 for(var k in seriData){
                  var key = seriData[k].name;
                  var value = seriData[k].value;
                  // console.log(key,value);
                  formData.append(key,value); 
                 }
                 formData.append('image',image); 

                  $.ajax({
                    "type":'post',
                    "url":"{:url('/admin/updatearticle')}",
                    "data":formData,
                    "dataType":"json",
                    "processData":false, //不转化数据
                    "contentType":false, //不转化数据类型
                    "success":function(res){
                      if(res.code == 200){
                        xadmin.close();
                        xadmin.father_reload();
                      }
                      layerMsg(res.msg);
                    }
                  });
                 return false; //阻止表单的默认跳转行为
              });

        });
        </script>
        
    </body>

</html>
