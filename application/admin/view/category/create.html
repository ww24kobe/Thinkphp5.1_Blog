<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        {include file="common/header" /}
    </head>
    <body>
        <div class="layui-fluid">
            <div class="layui-row">
                <form class="layui-form">
                  <div class="layui-form-item">
                      <label for="username" class="layui-form-label">
                          <span class="x-red"></span>分类名称
                      </label>
                      <div class="layui-input-inline">
                          <input type="text" id="username" name="name" 
                          autocomplete="off" class="layui-input">
                      </div>
                      <div class="layui-form-mid layui-word-aux">
                          <span class="x-red"></span>
                      </div>
                  </div>
                   <div class="layui-form-item">
                    <label for="username" class="layui-form-label">
                        <span class="x-red">*</span>所属分类</label>
                    <div class="layui-input-inline">
                        <select name="parent_id" >
                            <option value=''>请选择分类</option>
                            <option value='0'>顶级分类</option>
                            {volist name='categorys' id='v'}
                              <option value="{$v['categoryid']}">{:str_repeat('&nbsp;&nbsp;',$v['level']*2)}{$v['name']}</option>
                            {/volist}
                        </select>
                    </div>
                </div>
                <div class="layui-form-item layui-form-text">
                    <label for="desc" class="layui-form-label">分类介绍</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" id="desc" name="intro" class="layui-textarea"></textarea>
                    </div>
                </div>
                  
                
                  <div class="layui-form-item">
                      <label for="L_repass" class="layui-form-label">
                      </label>
                      <button  class="layui-btn" lay-filter="add" lay-submit="">
                          增加
                      </button>
                  </div>
              </form>
            </div>
        </div>
        <script>
          layui.use(['form', 'layer'],function() {
                $ = layui.jquery;
                var form = layui.form,
                layer = layui.layer;

                //自定义验证规则(只要自定义规则返回了数据，就代表没有验证通过)
                // form.verify({
                //     nikename: function(value) {
                //         if (value.length < 5) {
                //             return '昵称至少得5个字符啊';
                //         }
                //     }
                // });
                /*
                
                 */
                //监听提交
                form.on('submit(add)',function(data) {
                    //loading提示
                    var index = loading();
                    $.post("{:url('/admin/savecategory')}",data.field,function(res){
                      //关闭loading提示
                      closeLoading(index);
                      if(res.code == 200){
                        //发异步，把数据提交给php
                        layer.alert(res.msg, {
                            icon: 6
                        },function() {
                            //关闭当前frame
                            xadmin.close();
                            // 可以对父窗口进行刷新 
                            xadmin.father_reload();
                        });
                      }else{
                        layer.msg(res.msg);
                      }
                    },'json');
                    
                   return false; //阻止表单的默认跳转行为
                });

            });
          </script>
        
    </body>

</html>
